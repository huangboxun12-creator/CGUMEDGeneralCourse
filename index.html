<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é•·åºšé†«å­¸ç³»é€šè­˜å¿ƒå¾—ç¶²</title>
    <style>
        /* ç¹¼æ‰¿ everyclass.css é¢¨æ ¼ */
        body { background-color: #f0f2f5; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        .label_title { font-size: 25px; font-weight: bold; width: 95%; max-width: 600px; text-align: center; color: black; background-color: #87e967; padding: 15px; border-radius: 10px; border: 3px solid #000; margin: 10px 0; }
        .label_info { font-size: 18px; font-weight: bold; width: 95%; max-width: 600px; text-align: center; color: black; background-color: #fddb69; padding: 10px; border-radius: 10px; border: 3px solid #000; margin: 10px 0; }
        .label_comment { font-size: 16px; width: 95%; max-width: 600px; background-color: #ffffff; border-radius: 10px; padding: 15px; border: 3px solid #000; margin-bottom: 15px; text-align: left; line-height: 1.6; }
        .btn_menu { font-size: 18px; font-weight: bold; width: 95%; max-width: 600px; background-color: #7edcfc; border-radius: 10px; padding: 15px; border: 3px solid #000; cursor: pointer; box-shadow: 3px 3px 3px #29c6fa; margin: 8px 0; transition: 0.2s; }
        .btn_menu:hover { transform: scale(1.02); background-color: #58d2fb; }
        .btn_back { background-color: #bbb; box-shadow: 3px 3px 3px #888; width: auto; min-width: 120px; margin-bottom: 20px; }
        .layer { display: none; width: 100%; flex-direction: column; align-items: center; }
        .active { display: flex; }
        hr { border: 1px dashed #000; margin: 10px 0; }
    </style>
</head>
<body>

    <div class="label_title">é•·åºšé†«å­¸ç³»é€šè­˜å¿ƒå¾—ç¶² ğŸ“š</div>

    <main style="width: 100%; display: flex; flex-direction: column; align-items: center;">
        
        <div id="layer1" class="layer active">
            <div class="label_info">è«‹é¸æ“‡é¡åˆ¥</div>
            <button class="btn_menu" onclick="showLayer2('æ ¸å¿ƒ')">æ ¸å¿ƒé€šè­˜</button>
            <button class="btn_menu" onclick="showLayer2('å¤šå…ƒ')">å¤šå…ƒé€šè­˜</button>
        </div>

        <div id="layer2" class="layer">
            <button class="btn_menu btn_back" onclick="switchLayer(1)">â¬…ï¸ è¿”å›é¦–é </button>
            <div id="layer2_title" class="label_info"></div>
            <div id="sub_cat_container" style="width:100%; display:flex; flex-direction:column; align-items:center;"></div>
        </div>

        <div id="layer3" class="layer">
            <button class="btn_menu btn_back" onclick="switchLayer(2)">â¬…ï¸ è¿”å›é ˜åŸŸ</button>
            <div id="layer3_title" class="label_info"></div>
            <div id="course_list_container" style="width:100%; display:flex; flex-direction:column; align-items:center;"></div>
        </div>

        <div id="layer4" class="layer">
            <button class="btn_menu btn_back" onclick="switchLayer(3)">â¬…ï¸ è¿”å›æ¸…å–®</button>
            <div id="final_title" class="label_title"></div>
            <div id="course_info_box" class="label_comment"></div>
            <div id="reviews_container" style="width:100%; display:flex; flex-direction:column; align-items:center;"></div>
        </div>

    </main>

<script>
// --- é è¼‰èª²ç¨‹è³‡æ–™ (å¾å„å·¥ä½œè¡¨æ•´ç†) ---
const courseData = {
    "æ ¸å¿ƒ": {
        "è—è¡“èˆ‡äººæ–‡æ€ç¶­": [
            { id: "A2826", name: "æ­ŒåŠ‡èˆ‡æ­ŒåŠ‡é™¢", teacher: "å»–å©‰å¦‚", credit: 2, info: "çµåˆéŸ³æ¨‚ã€æ–‡å­¸ã€æˆ²åŠ‡ã€è¦–è¦ºè—è¡“çš„ç¶œåˆæ€§è¡¨æ¼”è—è¡“...", grading: "å‡ºå¸­20%ã€åˆ†çµ„è¨è«–/æœŸä¸­å£é ­å ±å‘Š30%ã€æœŸæœ«50%" },
            { id: "A2827", name: "ç¾ä»£è©©èˆ‡ç•¶ä»£æ–‡åŒ–", teacher: "å‘é™½", credit: 2, info: "è§£æç¾ä»£è©©çš„æ„è±¡ã€èªè¨€åŠå…¶èˆ‡ç•¶ä»£ç¤¾æœƒçš„é€£çµ...", grading: "å‡ºå¸­10%ã€èª²å¾Œç·´ç¿’30%ã€æœŸæœ«ç­†è©¦60%" }
        ],
        "å…¬æ°‘èˆ‡ç¤¾æœƒæ¢ç©¶": [
            { id: "A2846", name: "é†«å­¸èˆ‡æ³•å¾‹", teacher: "é™³ä»²éš†", credit: 2, info: "é‡å°é†«ç™‚ç³¾ç´›ã€çŸ¥æƒ…åŒæ„ç­‰é†«ç™‚æ³•å¾‹å¯¦å‹™é€²è¡Œè§£æ...", grading: "æœŸæœ«ç­†è©¦100%" },
            { id: "A2837", name: "è‡ºç£å²", teacher: "è”¡é¾ä¿", credit: 2, info: "è‡ºç£è¿‘ç¾ä»£å²çš„ç™¼å±•è»Œè·¡èˆ‡ç¤¾æœƒè½‰å‹...", grading: "å€‹äººç­†è¨˜50%ã€æœŸæœ«è©•é‡50%" }
        ],
        "å“²å­¸èˆ‡é“å¾·æ€è€ƒ": [
            { id: "A2850", name: "é‚è¼¯", teacher: "ç‹å† ä»", credit: 2, info: "ç¬¦è™Ÿé‚è¼¯åŸºç¤èˆ‡æ‰¹åˆ¤æ€è€ƒè¨“ç·´...", grading: "æœŸä¸­è€ƒ50%ã€æœŸæœ«è€ƒ50%" }
        ]
    },
    "å¤šå…ƒ": {
        "è‡ªç„¶ç§‘å­¸é ˜åŸŸ": [
            { id: "B1234", name: "ç’°å¢ƒä¿è­·å°è«–", teacher: "ææ˜å‹³", credit: 2, info: "æ°£å€™è®Šé·èˆ‡ç”Ÿæ…‹ä¿è‚²å°è«–...", grading: "å¿ƒå¾—å ±å‘Š40%ã€æœŸæœ«å°ˆé¡Œ60%" }
        ],
        "ç¤¾æœƒç§‘å­¸é ˜åŸŸ": [
            { id: "B5678", name: "å¿ƒç†å­¸å°è«–", teacher: "å¼µæ˜¥èˆˆ", credit: 2, info: "äººé¡è¡Œç‚ºèˆ‡å¿ƒç†æ­·ç¨‹çš„ç§‘å­¸ç ”ç©¶...", grading: "å‡ºå¸­20%ã€æœŸä¸­30%ã€æœŸæœ«50%" }
        ],
        "äººæ–‡èˆ‡è—è¡“é ˜åŸŸ": [
            { id: "B9012", name: "æ”å½±ç¾å­¸", teacher: "é™³å½±ä¹‹", credit: 2, info: "è¦–è¦ºæ§‹åœ–èˆ‡æ”å½±æ­·å²è§£æ...", grading: "å¯¦ä½œä½œæ¥­70%ã€æœŸæœ«å±•è¦½30%" }
        ]
    }
};

// --- Google Sheet å¿ƒå¾— CSV é€£çµ ---
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR8cTxUPOSQA1ypJytbZ01-CX5qXM-iXExvbaBOpWATCade5xf3WYsKLrdhbrBOAiegZiefn97HgGlv/pub?gid=313985456&single=true&output=csv";
let allReviews = [];

async function initReviews() {
    try {
        const res = await fetch(csvUrl);
        const text = await res.text();
        const rows = text.split('\n').map(r => r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/)).slice(1);
        allReviews = rows.map(row => ({
            name: (row[5] || row[13] || row[21] || row[29] || row[37] || "").replace(/"/g, ''),
            overall: row[7] || row[15] || row[23] || row[31] || row[39] || "?",
            sweet: row[8] || row[16] || row[24] || row[32] || row[40] || "?",
            comment: (row[12] || row[20] || row[28] || row[36] || row[44] || "").replace(/"/g, '')
        }));
        console.log("å¿ƒå¾—åŠ è¼‰å®Œæˆ");
    } catch (e) { console.error("å¿ƒå¾—è®€å–å¤±æ•—"); }
}

let currentMain = "";
let currentSub = "";

function showLayer2(main) {
    currentMain = main;
    switchLayer(2);
    document.getElementById('layer2_title').innerText = main;
    const container = document.getElementById('sub_cat_container');
    container.innerHTML = Object.keys(courseData[main]).map(sub => 
        `<button class="btn_menu" onclick="showLayer3('${sub}')">${sub}</button>`
    ).join('');
}

function showLayer3(sub) {
    currentSub = sub;
    switchLayer(3);
    document.getElementById('layer3_title').innerText = sub;
    const container = document.getElementById('course_list_container');
    container.innerHTML = courseData[currentMain][sub].map(c => 
        `<button class="btn_menu" onclick="showFinal('${c.name}')">${c.name} (${c.teacher})</button>`
    ).join('');
}

function showFinal(cName) {
    switchLayer(4);
    const course = courseData[currentMain][currentSub].find(c => c.name === cName);
    document.getElementById('final_title').innerText = cName;
    document.getElementById('course_info_box').innerHTML = `
        <b>ğŸ‘¨â€ğŸ« æˆèª²æ•™å¸«ï¼š</b>${course.teacher}<br>
        <b>ğŸ†” é–‹èª²åºè™Ÿï¼š</b>${course.id} | <b>ğŸ“ å­¸åˆ†ï¼š</b>${course.credit}<br>
        <hr>
        <b>ğŸ“– èª²ç¨‹ç°¡ä»‹ï¼š</b><br>${course.info}<br><br>
        <b>ğŸ“ è©•åˆ†æ–¹å¼ï¼š</b><br>${course.grading}
    `;

    const reviews = allReviews.filter(r => r.name === cName);
    const rContainer = document.getElementById('reviews_container');
    rContainer.innerHTML = reviews.length ? reviews.map(r => `
        <div class="label_info">â­è©•åˆ†: ${r.overall}/5 | ğŸ¬ç”œåº¦: ${r.sweet}/10</div>
        <div class="label_comment">${r.comment || "é€™ä½åŒå­¸å¾ˆç¥ç¥•ï¼Œä»€éº¼éƒ½æ²’å¯«ğŸ« "}</div>
    `).join('') : '<div class="label_info">ç›®å‰å°šç„¡å¿ƒå¾—ï¼Œå¿«ä¾†ç•¶ç¬¬ä¸€å€‹åˆ†äº«è€…å§ï¼</div>';
}

function switchLayer(n) {
    document.querySelectorAll('.layer').forEach(l => l.classList.remove('active'));
    document.getElementById('layer' + n).classList.add('active');
}

// å•Ÿå‹•åŠ è¼‰å¿ƒå¾—
initReviews();
</script>
</body>
</html>
